<html>
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4D6N4P07B7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-4D6N4P07B7');
    </script>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
  </head>
  <body>
    <audio id="scream" src="scream.mp3" type="audio/mpeg"></audio>
    <audio id="snare" src="snare.wav" type="audio/wav"></audio>
    <script>
   
      let player = {x: 0, z: 0};
      let tiles = [];

      function isInline(tile) {
         console.log("is inline: " + tile.id + ": " + tile.x + ", " + tile.z);
         // TODO: Updat thie to check there is a row between... 
         if (player.x === tile.x || player.z === tile.z) {
          console.log('this is inline');
         }
      } 

      AFRAME.registerComponent('raycaster-listener', {
        init: function() {
          this.el.addEventListener('raycaster-intersected', function(evt) {
            console.log('intersected element with id: ' + evt.target.id);
            //this.el.setAttribute('material', 'color', 'blue');
            for (tile in tiles) {
              if (evt.target.id == tiles[tile].id) {
                document.getElementById(tiles[tile].id).setAttribute('material', 'color', 'blue');
                isInline(tiles[tile]);
              } else {
              
             //   document.getElementById(tiles[tile]).removeAttribute('material', 'color');
              }
            }
          });

          this.el.addEventListener('raycaster-intersected-cleared', function(evt) {
            console.log('intersect cleared element with id: ' + evt.target.id);
           // this.el.removeAttribute('material', 'color');
             for (tile in tiles) {
              if (evt.target.id == tiles[tile].id) {
                document.getElementById(tiles[tile].id).removeAttribute('material', 'color');
                
              } else {
                
               // document.getElementById(tiles[tile]).removeAttribute('material', 'color');
              }
            }
          });

          this.el.addEventListener('click', function (evt) {
            console.log('raycaster-listener click');
            document.getElementById('scream').play();
          });


        }
      });


      AFRAME.registerComponent('cursor-listener', {
  init: function () {
    
    this.el.addEventListener('mouseenter', function (evt) {
    //  console.log("entering " + evt.target.id);

      for (tile in tiles) {
        if (evt.target.id == tiles[tile].id) {
          document.getElementById(tiles[tile].id).setAttribute('material', 'color', 'blue');
        } else {
          document.getElementById(tiles[tile].id).removeAttribute('material', 'color');
        }
      }

     // console.log('I was clicked at: ', evt.detail.intersection.point);
    });

    this.el.addEventListener('mouseleave', function (evt) {
    //  console.log("leaving " + evt.target.id);
      this.removeAttribute('material', 'color');
      
    });

    this.el.addEventListener('click', function (evt) {
      console.log('cursor-listener click');
      document.getElementById('snare').play();
      console.log('Clicked item position: ' + evt.target.getAttribute('position'));

      var position = evt.target.getAttribute('position');

      // var cameraPosition = {};
      // cameraPosition['x'] = position['x'];
      // cameraPosition['y'] = '1.6';
      // cameraPosition['z'] = position['z'];
      newPositionString = position['x'] + ' 0 ' + position['z'];

      console.log('I was clicked at: ', evt.detail.intersection.point);

      var anim = document.createElement('a-animation');
      anim.setAttribute('attribute', 'position');
      anim.setAttribute('dur', '1000');
      anim.setAttribute('easing', 'linear');
      anim.setAttribute('to', newPositionString);
      document.getElementById('camera-test').appendChild(anim);
      //document.getElementById('camera-entity').setAttribute('position', cameraPosition);
    });
  }
});
    </script>
    <a-scene id="scene">

      <a-entity position="0 1.6 0">      
          <a-entity laser-controls="hand: left" raycaster="objects: .clickable"></a-entity>
        
    
          <a-entity laser-controls="hand: right" raycaster="objects: .clickable"></a-entity>
      </a-entity>
      
      <a-assets>
        <a-asset-item id="saucer-obj" src="saucernormals.obj" ></a-asset-item>
        <a-asset-item id="saucer-mtl" src="saucernormals.mtl"></a-asset-item>
      </a-assets>
      <a-entity obj-model="obj: #saucer-obj; mtl: #saucer-mtl" scale="0.2 0.2 0.2" >
       
        <a-entity position="5 0 0"></a-entity>
        <a-animation attribute="rotation"
               dur="1000"
               fill="forwards"
               to="0 360 0"
               easing="linear"
               repeat="indefinite"></a-animation>
               <a-animation attribute="position" from="1 1 1" to="2 4 -8" repeat="indefinite"></a-animation>
      </a-entity>
      <a-sphere position="-4 0.75 -6" radius="0.25" color="#EF2D5E"></a-sphere>
      <a-cylinder position="0 0.75 -4" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
      <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
      <a-sky color="#ECECEC"></a-sky>

      <a-box raycaster-listener cursor-listener class="clickable" id="evert" material="src: evs.jpg;" position="0 2 -5" rotation="0 45 45" scale="1 1 1" 
      animation="property: object3D.position.y; to: 6; dir: alternate; dur: 3000; loop: true"
      animation="property: object3D.rotation.y; to: 0.8; dir: alternate; dur: 500; loop: true"></a-box>

      <a-box raycaster-listener cursor-listener class="clickable" id="elmo" material="src: elmo.jpg;" position="-2 4 -2" rotation="0 45 45" scale="1 1 1" 
      animation="property: object3D.position.y; to: 3; dir: alternate; dur: 900; loop: true"
      animation="property: object3D.rotation.y; to: 0.8; dir: alternate; dur: 500; loop: true"></a-box>

      <a-box raycaster-listener cursor-listener class="clickable" id="lils" material="src: lils.jpg;" position="1 4 -2" rotation="0 45 45" scale="1 1 1" 
      animation="property: object3D.position.y; to: 3; dir: alternate; dur: 1200; loop: true"
      animation="property: object3D.rotation.y; to: 0.8; dir: alternate; dur: 500; loop: true"></a-box>

      <a-box raycaster-listener cursor-listener class="clickable" id="arley" material="src: arley.jpg;" position="4 6 -3" rotation="0 0 45" scale="1 1 1" 
      animation="property: object3D.position.y; to: 3; dir: alternate; dur: 500; loop: true"
      animation="property: object3D.rotation.y; to: 0.8; dir: alternate; dur: 500; loop: true"></a-box>

     
     <!-- 
      <a-box class="clickable" id="abox1" raycaster-listener cursor-listener position="0 0.5 0" height="0.05" material="src: greytile.jpg;"></a-box>
      <a-box class="clickable" id="abox2" raycaster-listener cursor-listener position="0 0.5 -1" height="0.05" material="src: whitetile.jpg;"></a-box>
      <a-box class="clickable" id="abox3" raycaster-listener cursor-listener position="0 0.5 -2" height="0.05" material="src: greytile.jpg;"></a-box>
      <a-box class="clickable" id="abox4" raycaster-listener cursor-listener position="0 0.5 -3" height="0.05" material="src: whitetile.jpg;"></a-box>
      <a-box class="clickable" id="abox5" raycaster-listener cursor-listener position="-1 0.5 -3" height="0.05" material="src: greytile.jpg;"></a-box>
      <a-box class="clickable" id="abox6" raycaster-listener cursor-listener position="-2 0.5 -3" height="0.05" material="src: whitetile.jpg;"></a-box>
      <a-box class="clickable" id="abox7" raycaster-listener cursor-listener position="-3 0.5 -3" height="0.05" material="src: greytile.jpg;"></a-box>
      <a-box class="clickable" id="abox8" raycaster-listener cursor-listener position="-3 0.5 -4" height="0.05" material="src: whitetile.jpg;"></a-box>
      <a-box class="clickable" id="abox9" raycaster-listener cursor-listener position="-3 0.5 -5" height="0.05" material="src: greytile.jpg;"></a-box>
      <a-box class="clickable" id="abox10" raycaster-listener cursor-listener position="-2 0.5 -5" height="0.05" material="src: whitetile.jpg;"></a-box>
      <a-box class="clickable" id="abox11" raycaster-listener cursor-listener position="-1 0.5 -5" height="0.05" material="src: greytile.jpg;"></a-box>
      <a-box class="clickable" id="abox12" raycaster-listener cursor-listener position="-1 0.5 -6" height="0.05" material="src: whitetile.jpg;"></a-box>
      <a-box class="clickable" id="abox13" raycaster-listener cursor-listener position="-2 0.5 -6" height="0.05" material="src: greytile.jpg;"></a-box>
      <a-box class="clickable" id="abox14" raycaster-listener cursor-listener position="-3 0.5 -6" height="0.05" material="src: whitetile.jpg;"></a-box>
      <a-box class="clickable" id="abox15" raycaster-listener cursor-listener position="-4 0.5 -6" height="0.05" material="src: greytile.jpg;"></a-box>
-->
      <a-entity id='camera-entity' position="0 1.6 0">
      <a-camera id='camera-test'>
        
   <!-- TODO  Put this back in to get the gaze pointer thing.
        <a-entity cursor="fuse: false; fuseTimeout: 500"
            position="0 0 -1"
            geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.028"
            material="color: black; shader: flat"> -->

        </a-entity>
      </a-camera>
      </a-entity>
    </a-scene>

    <script>
      
      const floorLevel = 0.5;

      let steps = [
        {x: 0, z: 0},
        {x: 0, z: -1},
        {x: 0, z: -2},
        {x: 0, z: -3},
        {x: -1, z: -3},
        {x: -2, z: -3},
        {x: -3, z: -3},
        {x: -3, z: -4},
        {x: -3, z: -5},
        {x: -2, z: -5},
        {x: -1, z: -5},
        {x: -1, z: -6},
        {x: -2, z: -6},
        {x: -3, z: -6},
        {x: -4, z: -6},
      ];

      let scene = document.getElementById('scene');

      tiles.push({x: 0, z: 0, id: 'evert'});
      tiles.push({x: 0, z: 0, id: 'arley'});
      tiles.push({x: 0, z: 0, id: 'elmo'});
      tiles.push({x: 0, z: 0, id: 'lils'});

      for (num in steps) {
        let step = steps[num];
        console.log('step = ' + step);
        let id = "box" + num;
        
        let aTile = document.createElement('a-box');
        aTile.setAttribute('id', id);
        tiles.push({x: step.x, z: step.z, id: id});
        aTile.setAttribute('class', 'clickable');
        if ((step.x + step.z) % 2 == 0) {
          aTile.setAttribute('material', 'src: greytile.jpg;');
        } else {
          aTile.setAttribute('material', 'src: whitetile.jpg;');

        }
        //aTile.setAttribute('material', 'src: greytile.jpg;');
        aTile.setAttribute('height', '0.05');
        aTile.setAttribute('raycaster-listener', "");
        aTile.setAttribute('cursor-listener', "");
        const position = step.x + ' ' + floorLevel + ' ' + step.z;
        console.log('position = ' + position);
        aTile.setAttribute('position', position);
        scene.appendChild(aTile);
      }

      
      
    </script>
  </body>
</html>
